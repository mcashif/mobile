{% load crispy_forms_tags %}
{% load staticfiles %}
<!DOCTYPE html>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
var geocoder = new google.maps.Geocoder();

function geocodePosition(pos) {
  geocoder.geocode({
    latLng: pos
  }, function(responses) {
    if (responses && responses.length > 0) {
      updateMarkerAddress(responses[0].formatted_address);
    } else {
      updateMarkerAddress('Cannot determine address at this location.');
    }
  });
}

function updateMarkerStatus(str) {
  document.getElementById('markerStatus').innerHTML = str;
}

function updateMarkerPosition(latLng) {
  var vlat = document.getElementById("lat");
         vlat.value = latLng.lat();
  var vlng = document.getElementById("lng");
          vlng.value = latLng.lng();
}

function updateMarkerAddress(str) {
  var vadd = document.getElementById("add");
         vadd.value = str;
}

function initialize() {
  var latLng = new google.maps.LatLng(33.60119932645364, 73.11817166137689);
  var map = new google.maps.Map(document.getElementById('mapCanvas'), {
    zoom: 10,
    center: latLng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });
  var marker = new google.maps.Marker({
    position: latLng,
    title: 'Point A',
    map: map,
    draggable: true
  });

  // Update current position info.
  updateMarkerPosition(latLng);
  geocodePosition(latLng);

  // Add dragging event listeners.
  google.maps.event.addListener(marker, 'dragstart', function() {
    updateMarkerAddress('Finding...');
  });

  google.maps.event.addListener(marker, 'drag', function() {
    updateMarkerStatus('Finding...');
    updateMarkerPosition(marker.getPosition());
  });

  google.maps.event.addListener(marker, 'dragend', function() {
    updateMarkerStatus('Finding ended');
    geocodePosition(marker.getPosition());
  });
}

    // Onload handler to fire off the app.
    google.maps.event.addDomListener(window, 'load', initialize);
    </script>

<html>
  <head>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    #mapCanvas {
      width: 800px;
      height: 600px;
      float: left;
    }
    #infoPanel {
      float: left;
      margin-left: 10px;
    }
    #infoPanel div {
      margin-bottom: 5px;
    }
    </style>

{% block content %}

      <div class="pagination" style="width:800px; margin:0 auto;">
      <div id="mapCanvas" ></div>
      <div id="infoPanel">
        <b>Marker status:</b>
        <div id="markerStatus"><i>Click and drag the marker.</i></div>
        <div id="address"></div>
      </div></div>


          <h1>Client Data</h1>
          <form method="POST" class="post-form">{% csrf_token %}
            {{form}}
              Address:  <input type="text" id="add" name="add" /><br>
              Latitude: <input type="text" id="lat" name="elat"/><br>
              Longitude:  <input type="text" id="lng" name="elng" /><br>

              <button type="submit" class="save btn btn-default">Save</button>
          </form>
      {% endblock %}

    </head>
    <body>
</html>
